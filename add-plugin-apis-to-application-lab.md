# Add plugin apis to Application Lab

## In the **_SimpleUI/WebContent/Simple/doc/swaggerModel.yaml_** file:
- Create a **_\<name\>Step_** definition and any related object needed at the bottom of the file.  
  For example:
```yaml
RestfulStep:
properties:
  agent:
    type: string
    description: Agent name where the command will run
  action:
    $ref: '#/definitions/RestAction'
  authdata:
    $ref: '#/definitions/RestAuthenticationData'
  input:
    $ref: '#/definitions/RestInput'
    
RestAction:
properties:
  uri:
    type: string
    description: The uri for the call
  accept:
    type: string
    description: What the call accept as response
  contentType:
    type: string
    description: The content-type of the call
  method:
    type: string
    description: The method of the call
  outputFileName:
    type: string
    description: The output file generated by the call
  verifyHostname:
    type: boolean
    description: Say if the hostname will be verified or not
  queryParameters:
    type: object
    description: The parameter to set in the query URL
  headers:
    type: object
    description: The header of the call
  jsonObjectResultQuery:
    type: string
    description: The result of the call
  numOfRetries:
    type: integer
    description: The number of retries, the step will try automatically, if the URI is not available, before exit with an error
  retryIntervalSeconds:
    type: integer
    description: Interval between two retries, in seconds

RestAuthenticationData:
properties:
  username:
    type: string
    description: The user that perform the call
  password:
    type: string
    description: The password of the user
  keyStoreFilePath:
    type: string
    description: No description avaible
  keyStoreFilePassword:
    type: string
    description: No description avaible

RestInput:
 properties:
  input:
    type: string
    description: The input for the call, if isFile is true, is considered as a file name, that must be present on the agent filesystem
  isFile:
    type: boolean
    description: If true use "input" as input as file name, and uses file content as input for the rest call. Otherwise uses input directly as input
```

- Add its reference in the **_Step_** definition

## in the **_SimpleUI/src/com/ibm/tws/simpleui/service/utils/Step2ActionUtil.java_**
Add the "else" clause that will create the plugin action. 
See the example code below:  
```java
JsonObject subStep = (JsonObject) step.getMember("restfulStep");
JsonObject actionJson = (JsonObject) subStep.getMember("action");
JsonObject authDataJson = (JsonObject) subStep.getMember("authdata");
JsonObject input = (JsonObject) subStep.getMember("input");

RESTAction restAction = new RESTAction(actionJson.getMemberAsString("uri",""),
        actionJson.getMemberAsString("accept",""),
        actionJson.getMemberAsString("contentType",""),
        actionJson.getMemberAsString("method",""),
        new HashMap<String, String>(),
        new HashMap<String, String>(), 
        actionJson.getMemberAsString("jsonObjectResultQuery",""),
        actionJson.getMemberAsString("outputFileName",""),
        actionJson.getMemberAsInt("numberOfRetries",0),
        actionJson.getMemberAsInt("retryIntervalSeconds",30));

RESTAuthenticationData authData  = RESTAuthenticationData
        .fromUserPwdCert(
                authDataJson.getMemberAsString("username",""),
                authDataJson.getMemberAsString("password",""),
                authDataJson.getMemberAsString("keyStoreFilePath",""),
                authDataJson.getMemberAsString("keyStoreFilePassword",""));


RESTInput restInput;
if ( input.getMemberAsBoolean("isFile",false) ) {
    restInput = RESTInput.fromFile(input.getMemberAsString("input"));
} else {
    restInput = RESTInput.fromText(input.getMemberAsString("input"));
}

action = new RestfulStep(subStep.getMemberAsString("agent",""), restAction, authData, restInput);  
```